(()=>{"use strict";const e=Object.freeze({dictionary:"object",mode:"strict"}),t=Symbol("EMPTY_KEY"),r=(Symbol("OMIT_VALUE"),5.960464477539063e-8),n=9007199254740992,o=8192,a=64,i=69,c=70,s=72,u=77,f=78,l=85,d=86;var y,h,g=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class w{static from(e){return new w(Array.from(e))}constructor(e){y.add(this),Object.defineProperty(this,"_data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._data=e||[]}add(e){return this._data.push(e)-1}remove(e){return this._data.splice(e,1)[0]}get(e){return this._data[e]}clone(){return new w(this.data)}get data(){return Array.from(this._data)}get size(){return this._data.length}[(y=new WeakSet,Symbol.toStringTag)](){return"Sequence"}[(h=function(e){return`${this[Symbol.toStringTag]()}(${this.size}) ${e(this._data)}`},Symbol.for("Deno.customInspect"))](e){return g(this,y,"m",h).call(this,e)}[Symbol.for("nodejs.util.inspect.custom")](e,t,r){return g(this,y,"m",h).call(this,r)}}class p{static create(e){if(void 0===e)return new p(23);if(null===e)return new p(22);if(!0===e)return new p(21);if(!1===e)return new p(20);if("number"==typeof e&&e>=0&&e<=255)return new p(e);throw new Error("CBORError: Value out of range or not a simple value.")}constructor(e){switch(Object.defineProperty(this,"semantic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!0){case 20===e:this.semantic="false";break;case 21===e:this.semantic="true";break;case 22===e:this.semantic="null";break;case 23===e:this.semantic="undefined";break;case e>23&&e<32:this.semantic="reserved";break;default:this.semantic="unassigned"}this.value=e}toPrimitive(){switch(this.semantic){case"false":return!1;case"true":return!0;case"null":return null;default:return}}}class m{constructor(e,t){Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tag",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e,this.tag=t}}function b(y,h,g={}){const{dictionary:b,mode:E}=function(t){const r={...e};var n;return"object"==typeof t&&(r.dictionary="string"==typeof(n=t.dictionary)&&["object","map"].includes(n)?t.dictionary:e.dictionary,r.mode=function(e){return"string"==typeof e&&["loose","strict","sequence"].includes(e)}(t.mode)?t.mode:e.mode),Object.freeze(r)}(g),S="sequence"===E||"strict"===E,A=new DataView(y),v=new Uint8Array(y);let O=0,C=function(e,t){return t};function $(e,t){return O+=e,t}function B(e){return $(e,new Uint8Array(y,O,e))}function j(){return $(1,v[O])}function _(){return $(2,A.getUint16(O))}function T(){return 255===v[O]&&(O+=1,!0)}function U(e){if(e<24)return e;if(24===e)return j();if(25===e)return _();if(26===e)return $(4,A.getUint32(O));if(27===e){const e=$(8,A.getBigUint64(O));return e<n?Number(e):e}if(31===e)return-1;throw new Error("CBORError: Invalid length encoding")}function P(e){const t=j();if(255===t)return-1;const r=U(31&t);if(r<0||t>>5!==e)throw new Error("CBORError: Invalid indefinite length element");return Number(r)}function I(e,t){for(let r=0;r<t;++r){let r=j();128&r&&(r<224?(r=(31&r)<<6|63&j(),t-=1):r<240?(r=(15&r)<<12|(63&j())<<6|63&j(),t-=2):(r=(15&r)<<18|(63&j())<<12|(63&j())<<6|63&j(),t-=3)),r<65536?e.push(r):(r-=65536,e.push(55296|r>>10),e.push(56320|1023&r))}}function L(){const e=j(),n=e>>5,y=31&e;let h,g;if(7===n)switch(y){case 25:return function(){const e=new ArrayBuffer(4),t=new DataView(e),n=_(),o=32768&n;let a=31744&n;const i=1023&n;if(31744===a)a=261120;else if(0!==a)a+=114688;else if(0!==i)return(o?-1:1)*i*r;return t.setUint32(0,o<<16|a<<13|i<<13),t.getFloat32(0)}();case 26:return $(4,A.getFloat32(O));case 27:return $(8,A.getFloat64(O))}if(g=U(y),g<0&&(n<2||6<n))throw new Error("CBORError: Invalid length");switch(n){case 0:return C(t,g);case 1:return C(t,"number"==typeof g?-1-g:-1n-g);case 2:if(g<0){const e=[];let r=0;for(;(g=P(n))>=0;)r+=g,e.push(B(g));const o=new Uint8Array(r);let a=0;for(h=0;h<e.length;++h)o.set(e[h],a),a+=e[h].length;return C(t,o)}return C(t,B(g));case 3:{const e=[];if(g<0)for(;(g=P(n))>=0;)I(e,g);else I(e,g);let r="";for(h=0;h<e.length;h+=o)r+=String.fromCharCode.apply(null,e.slice(h,h+o));return C(t,r)}case 4:{let e;if(g<0){e=[];let t=0;for(;!T();)e.push(C(t++,L()))}else for(e=new Array(g),h=0;h<g;++h)e[h]=C(h,L());return C(t,e)}case 5:{if("map"===b){const e=new Map;for(h=0;h<g||g<0&&!T();++h){const t=L();if(S&&e.has(t))throw new Error("CBORError: Duplicate key encountered");e.set(t,C(t,L()))}return C(t,e)}const e={};for(h=0;h<g||g<0&&!T();++h){const t=L();if(S&&Object.prototype.hasOwnProperty.call(e,t))throw new Error("CBORError: Duplicate key encountered");e[t]=C(t,L())}return C(t,e)}case 6:{const e=L(),r=g;if(e instanceof Uint8Array){const n=e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset);switch(r){case a:return C(t,new Uint8Array(n));case s:return C(t,new Int8Array(n));case i:return C(t,new Uint16Array(n));case u:return C(t,new Int16Array(n));case c:return C(t,new Uint32Array(n));case f:return C(t,new Int32Array(n));case l:return C(t,new Float32Array(n));case d:return C(t,new Float64Array(n))}}return C(t,new m(e,r))}case 7:switch(g){case 20:return C(t,!1);case 21:return C(t,!0);case 22:return C(t,null);case 23:return C(t,void 0);default:return C(t,new p(g))}}}"function"==typeof h&&(C=h);const x=L();if(O!==y.byteLength){if("sequence"!==E)throw new Error("CBORError: Remaining bytes");const e=new w([x]);for(;O<y.byteLength;)e.add(C(t,L()));return e}return"sequence"===E?new w([x]):x}const E="function"==typeof Buffer,S=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder,Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")),A=((e=>{let t={};e.forEach(((e,r)=>t[e]=r))})(S),String.fromCharCode.bind(String)),v=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_"))),O="function"==typeof btoa?e=>btoa(e):E?e=>Buffer.from(e,"binary").toString("base64"):e=>{let t,r,n,o,a="";const i=e.length%3;for(let i=0;i<e.length;){if((r=e.charCodeAt(i++))>255||(n=e.charCodeAt(i++))>255||(o=e.charCodeAt(i++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|o,a+=S[t>>18&63]+S[t>>12&63]+S[t>>6&63]+S[63&t]}return i?a.slice(0,i-3)+"===".substring(i):a},C=E?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let r=0,n=e.length;r<n;r+=4096)t.push(A.apply(null,e.subarray(r,r+4096)));return O(t.join(""))},$=(e,t=!1)=>t?v(C(e)):C(e),B=18;function j(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)}const _=new Map([[-7,"ES256"],[-35,"ES384"],[-36,"ES512"],[-37,"PS256"],[-38,"PS384"],[-39,"PS512"],[-16,"SHA-256"],[-43,"SHA-384"],[-44,"SHA-512"]]);function T(e){return _.has(e)?`${e} (${_.get(e)})`:L(e)}function U(e){return`<${e.byteLength} bytes: ${t=e,Array.prototype.map.call(t,(function(e){return("0"+(255&e).toString(16)).slice(-2)})).join("")}>`;var t}function P(e){return`<${e.byteLength} bytes: ${t=e,$(t)}>`;var t}function I(e){return Array.isArray(e)?"["+e.map(P).join(", ")+"]":P(e)}function L(e){let t;if(Array.isArray(e))t="["+e.map(L).join(", ")+"]";else if(ArrayBuffer.isView(e))t=U(e);else if(e instanceof Object.getPrototypeOf(Uint8Array))t=P(e);else if("string"==typeof e)t=`"${e}"`;else if("number"==typeof e)t=e.toString();else if(e instanceof Map){t="[";for(const[r,n]of e)t+=`  (${L(r)}): ${L(n)},`;t+="]"}else t=e.tag?`Tag(${e.tag}) ${L(e.value)}`:`<no pretty value: ${typeof e}>`;return t}const x=new Map([[1,["alg",T]],[2,["crit",function(e){return"["+e.map(L).join(", ")+"]"}]],[3,["content type",function(e){return L(e)}]],[4,["kid",function(e){return L(e)}]],[5,["IV",U]],[6,["Partial IV",U]],[7,["counter signature",function(e){return L(e)}]],[9,["CounterSignature0",U]],[10,["kid context",U]],[15,["CWT claims",L]],[32,["x5bag",I]],[33,["x5chain",I]],[34,["x5t",function(e){const[t,r]=e;return`[${T(t)}, ${U(r)}]`}]],[35,["x5u",function(e){return`"${e}"`}]]]);function k(e){try{const t=function(e){let t;try{t=b(e,null,{dictionary:"map"})}catch(e){throw console.log(e),new Error("Not a COSE_Sign1 message: CBOR decode error")}let r=null;if(t.tag){if(t.tag!=B)throw new Error("Not a COSE_Sign1 message: invalid tag");r=t.tag,t=t.value}if(!Array.isArray(t)||4!=t.length)throw new Error("Not a COSE_Sign1 message: not an array of length 4");const n=t[0],o=t[1],a=t[2],i=t[3];if(!ArrayBuffer.isView(n))throw new Error("Not a COSE_Sign1 message: protected header not wrapped in bstr");const c=b(j(n),null,{dictionary:"map"});if(!(c instanceof Map))throw new Error("Not a COSE_Sign1 message: protected header not a map");if(!(o instanceof Map))throw new Error("Not a COSE_Sign1 message: unprotected header not a map");if(!ArrayBuffer.isView(a))throw new Error("Not a COSE_Sign1 message: payload not a bstr");if(!ArrayBuffer.isView(i))throw new Error("Not a COSE_Sign1 message: signature not a bstr");return{size:e.byteLength,tag:r,phdr:c,uhdr:o,payload:a,signature:i}}(e);console.log(t),function(e){function t(e){let t="";for(const[r,n]of e)if(x.has(r)){const[e,o]=x.get(r);t+=`${r} (${e}): ${o(n)}\n`}else t+=`${L(r)}: ${L(n)}\n`;return t}const r=t(e.phdr),n=t(e.uhdr);let o=U(e.payload);try{o+="\n\nText:\n"+new TextDecoder("utf-8",{fatal:!0}).decode(e.payload)}catch(e){}const a=U(e.signature),i=`Type: COSE_Sign1 (tagged: ${!!e.tag})\nSize: ${e.size} bytes\n\nProtected Header\n================\n\n${r}\n\nUnprotected Header\n==================\n\n${n}\n\nPayload\n=======\n\n${o}\n\nSignature\n=========\n\n${a}`;document.getElementById("output").innerHTML=i}(t)}catch(e){console.log(e),document.getElementById("output").innerHTML=e.toString()}}async function M(){const e=document.getElementById("file").files[0];k(await e.arrayBuffer())}async function N(){var e;k((e=window.prompt("Paste hexdump here"),j(new Uint8Array(e.match(/[\da-f]{2}/gi).map((e=>parseInt(e,16)))))))}window.addEventListener("DOMContentLoaded",(()=>{document.getElementById("load-file").addEventListener("click",M),document.getElementById("load-hex").addEventListener("click",N)}))})();