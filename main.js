(()=>{"use strict";const e=Object.freeze({dictionary:"object",mode:"strict"}),t=Symbol("EMPTY_KEY"),r=(Symbol("OMIT_VALUE"),9007199254740992);var n,o,a=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class i{constructor(e){n.add(this),Object.defineProperty(this,"_data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._data=e||[]}static from(e){return new i(Array.from(e))}add(e){return this._data.push(e)-1}remove(e){return this._data.splice(e,1)[0]}get(e){return this._data[e]}clone(){return new i(this.data)}get data(){return Array.from(this._data)}get size(){return this._data.length}[(n=new WeakSet,Symbol.toStringTag)](){return"Sequence"}[(o=function(e){return`${this[Symbol.toStringTag]()}(${this.size}) ${e(this._data)}`},Symbol.for("Deno.customInspect"))](e){return a(this,n,"m",o).call(this,e)}[Symbol.for("nodejs.util.inspect.custom")](e,t,r){return a(this,n,"m",o).call(this,r)}}class c{constructor(e){switch(Object.defineProperty(this,"semantic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!0){case 20===e:this.semantic="false";break;case 21===e:this.semantic="true";break;case 22===e:this.semantic="null";break;case 23===e:this.semantic="undefined";break;case e>23&&e<32:this.semantic="reserved";break;default:this.semantic="unassigned"}this.value=e}static create(e){if(void 0===e)return new c(23);if(null===e)return new c(22);if(!0===e)return new c(21);if(!1===e)return new c(20);if("number"==typeof e&&e>=0&&e<=255)return new c(e);throw new Error("CBORError: Value out of range or not a simple value.")}toPrimitive(){switch(this.semantic){case"false":return!1;case"true":return!0;case"null":return null;default:return}}}class s{constructor(e,t){Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tag",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e,this.tag=t}}function u(n,o,a={}){const{dictionary:u,mode:f}=function(t){const r={...e};var n;return"object"==typeof t&&(r.dictionary="string"==typeof(n=t.dictionary)&&["object","map"].includes(n)?t.dictionary:e.dictionary,r.mode=function(e){return"string"==typeof e&&["loose","strict","sequence"].includes(e)}(t.mode)?t.mode:e.mode),Object.freeze(r)}(a),l="sequence"===f||"strict"===f,d=new DataView(n),y=new Uint8Array(n);let h=0,g=function(e,t){return t};function w(e,t){return h+=e,t}function p(e){return w(e,new Uint8Array(n,h,e))}function m(){return w(1,y[h])}function b(){return w(2,d.getUint16(h))}function E(){return 255===y[h]&&(h+=1,!0)}function S(e){if(e<24)return e;if(24===e)return m();if(25===e)return b();if(26===e)return w(4,d.getUint32(h));if(27===e){const e=w(8,d.getBigUint64(h));return e<r?Number(e):e}if(31===e)return-1;throw new Error("CBORError: Invalid length encoding")}function v(e){const t=m();if(255===t)return-1;const r=S(31&t);if(r<0||t>>5!==e)throw new Error("CBORError: Invalid indefinite length element");return Number(r)}function A(e,t){for(let r=0;r<t;++r){let r=m();128&r&&(r<224?(r=(31&r)<<6|63&m(),t-=1):r<240?(r=(15&r)<<12|(63&m())<<6|63&m(),t-=2):(r=(15&r)<<18|(63&m())<<12|(63&m())<<6|63&m(),t-=3)),r<65536?e.push(r):(r-=65536,e.push(55296|r>>10),e.push(56320|1023&r))}}function O(){const e=m(),r=e>>5,n=31&e;let o,a;if(7===r)switch(n){case 25:return function(){const e=new ArrayBuffer(4),t=new DataView(e),r=b(),n=32768&r;let o=31744&r;const a=1023&r;if(31744===o)o=261120;else if(0!==o)o+=114688;else if(0!==a)return(n?-1:1)*a*5.960464477539063e-8;return t.setUint32(0,n<<16|o<<13|a<<13),t.getFloat32(0)}();case 26:return w(4,d.getFloat32(h));case 27:return w(8,d.getFloat64(h))}if(a=S(n),a<0&&(r<2||6<r))throw new Error("CBORError: Invalid length");switch(r){case 0:return g(t,a);case 1:return g(t,"number"==typeof a?-1-a:-1n-a);case 2:if(a<0){const e=[];let n=0;for(;(a=v(r))>=0;)n+=a,e.push(p(a));const i=new Uint8Array(n);let c=0;for(o=0;o<e.length;++o)i.set(e[o],c),c+=e[o].length;return g(t,i)}return g(t,p(a));case 3:{const e=[];if(a<0)for(;(a=v(r))>=0;)A(e,a);else A(e,a);let n="";for(o=0;o<e.length;o+=8192)n+=String.fromCharCode.apply(null,e.slice(o,o+8192));return g(t,n)}case 4:{let e;if(a<0){e=[];let t=0;for(;!E();)e.push(g(t++,O()))}else for(e=new Array(a),o=0;o<a;++o)e[o]=g(o,O());return g(t,e)}case 5:{if("map"===u){const e=new Map;for(o=0;o<a||a<0&&!E();++o){const t=O();if(l&&e.has(t))throw new Error("CBORError: Duplicate key encountered");e.set(t,g(t,O()))}return g(t,e)}const e={};for(o=0;o<a||a<0&&!E();++o){const t=O();if(l&&Object.prototype.hasOwnProperty.call(e,t))throw new Error("CBORError: Duplicate key encountered");e[t]=g(t,O())}return g(t,e)}case 6:{const e=O(),r=a;if(e instanceof Uint8Array){const n=e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset);switch(r){case 64:return g(t,new Uint8Array(n));case 72:return g(t,new Int8Array(n));case 69:return g(t,new Uint16Array(n));case 77:return g(t,new Int16Array(n));case 70:return g(t,new Uint32Array(n));case 78:return g(t,new Int32Array(n));case 85:return g(t,new Float32Array(n));case 86:return g(t,new Float64Array(n))}}return g(t,new s(e,r))}case 7:switch(a){case 20:return g(t,!1);case 21:return g(t,!0);case 22:return g(t,null);case 23:return g(t,void 0);default:return g(t,new c(a))}}}"function"==typeof o&&(g=o);const C=O();if(h!==n.byteLength){if("sequence"!==f)throw new Error("CBORError: Remaining bytes");const e=new i([C]);for(;h<n.byteLength;)e.add(g(t,O()));return e}return"sequence"===f?new i([C]):C}const f="function"==typeof btoa,l="function"==typeof Buffer,d=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder,Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")),y=((e=>{let t={};e.forEach(((e,r)=>t[e]=r))})(d),String.fromCharCode.bind(String)),h=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_"))),g=f?e=>btoa(e):l?e=>Buffer.from(e,"binary").toString("base64"):e=>{let t,r,n,o,a="";const i=e.length%3;for(let i=0;i<e.length;){if((r=e.charCodeAt(i++))>255||(n=e.charCodeAt(i++))>255||(o=e.charCodeAt(i++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|o,a+=d[t>>18&63]+d[t>>12&63]+d[t>>6&63]+d[63&t]}return i?a.slice(0,i-3)+"===".substring(i):a},w=l?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let r=0,n=e.length;r<n;r+=4096)t.push(y.apply(null,e.subarray(r,r+4096)));return g(t.join(""))};function p(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)}const m=new Map([[-7,"ES256"],[-35,"ES384"],[-36,"ES512"],[-37,"PS256"],[-38,"PS384"],[-39,"PS512"],[-16,"SHA-256"],[-43,"SHA-384"],[-44,"SHA-512"]]);function b(e){return m.has(e)?`${e} (${m.get(e)})`:A(e)}function E(e){return`<${e.byteLength} bytes: ${t=e,Array.prototype.map.call(t,(function(e){return("0"+(255&e).toString(16)).slice(-2)})).join("")}>`;var t}function S(e){return`<${e.byteLength} bytes: ${t=e,((e,t=!1)=>t?h(w(e)):w(e))(t)}>`;var t}function v(e){return Array.isArray(e)?"["+e.map(S).join(", ")+"]":S(e)}function A(e){let t;return t=ArrayBuffer.isView(e)?E(e):"string"==typeof e?`"${e}"`:"number"==typeof e?e.toString():e.tag?`Tag(${e.tag}) ${A(e.value)}`:`<no pretty value: ${typeof e}>`,t}const O=new Map([[1,["alg",b]],[2,["crit",function(e){return"["+e.map(A).join(", ")+"]"}]],[3,["content type",function(e){return A(e)}]],[4,["kid",function(e){return A(e)}]],[5,["IV",E]],[6,["Partial IV",E]],[7,["counter signature",function(e){return"<counter signature>"}]],[9,["CounterSignature0",E]],[10,["kid context",E]],[32,["x5bag",v]],[33,["x5chain",v]],[34,["x5t",function(e){const[t,r]=e;return`[${b(t)}, ${E(r)}]`}]],[35,["x5u",function(e){return`"${e}"`}]]]);function C(e){try{const t=function(e){let t;try{t=u(e,null,{dictionary:"map"})}catch(e){throw console.log(e),new Error("Not a COSE_Sign1 message: CBOR decode error")}let r=null;if(t.tag){if(18!=t.tag)throw new Error("Not a COSE_Sign1 message: invalid tag");r=t.tag,t=t.value}if(!Array.isArray(t)||4!=t.length)throw new Error("Not a COSE_Sign1 message: not an array of length 4");const n=t[0],o=t[1],a=t[2],i=t[3];if(!ArrayBuffer.isView(n))throw new Error("Not a COSE_Sign1 message: protected header not wrapped in bstr");const c=u(p(n),null,{dictionary:"map"});if(!(c instanceof Map))throw new Error("Not a COSE_Sign1 message: protected header not a map");if(!(o instanceof Map))throw new Error("Not a COSE_Sign1 message: unprotected header not a map");if(!ArrayBuffer.isView(a))throw new Error("Not a COSE_Sign1 message: payload not a bstr");if(!ArrayBuffer.isView(i))throw new Error("Not a COSE_Sign1 message: signature not a bstr");return{size:e.byteLength,tag:r,phdr:c,uhdr:o,payload:a,signature:i}}(e);console.log(t),function(e){function t(e){let t="";for(const[r,n]of e)if(O.has(r)){const[e,o]=O.get(r);t+=`${r} (${e}): ${o(n)}\n`}else t+=`${A(r)}: ${A(n)}\n`;return t}const r=t(e.phdr),n=t(e.uhdr);let o=E(e.payload);try{o+="\n\nText:\n"+new TextDecoder("utf-8",{fatal:!0}).decode(e.payload)}catch(e){}const a=E(e.signature),i=`Type: COSE_Sign1 (tagged: ${!!e.tag})\nSize: ${e.size} bytes\n\nProtected Header\n================\n\n${r}\n\nUnprotected Header\n==================\n\n${n}\n\nPayload\n=======\n\n${o}\n\nSignature\n=========\n\n${a}`;document.getElementById("output").innerHTML=i}(t)}catch(e){console.log(e),document.getElementById("output").innerHTML=e.toString()}}async function $(){const e=document.getElementById("file").files[0];C(await e.arrayBuffer())}async function B(){var e;C((e=window.prompt("Paste hexdump here"),p(new Uint8Array(e.match(/[\da-f]{2}/gi).map((e=>parseInt(e,16)))))))}window.addEventListener("DOMContentLoaded",(()=>{document.getElementById("load-file").addEventListener("click",$),document.getElementById("load-hex").addEventListener("click",B)}))})();